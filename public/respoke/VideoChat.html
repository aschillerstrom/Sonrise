<!DOCTYPE html>

<head>
    <title>Respoke - Video Chat</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <!-- Respoke client library -->
    <script src="https://cdn.respoke.io/respoke.min.js"></script>

    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <!-- Compiled and minified CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0-beta/css/materialize.min.css">
    <!-- Compiled and minified JavaScript -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0-beta/js/materialize.min.js"></script>
    <!--jquery--> 
    <script language="JavaScript" type="text/javascript" src="/js/jquery-1.2.6.min.js"></script>
    <script language="JavaScript" type="text/javascript" src="/js/jquery-ui-personalized-1.5.2.packed.js"></script>
    <script language="JavaScript" type="text/javascript" src="/js/sprinkle.js"></script>    
    <script src="http://code.jquery.com/jquery-1.11.0.min.js"></script>
    <link rel="stylesheet" type="text/css" href="style.css"></style>
    </style>
</head>

<body>

        <nav class="white" role="navigation">
                <div class="nav-wrapper container">
                <a id="logo-container" href="../public/index.html" class="brand-logo">SonRise</a>
            
                  <ul class="right hide-on-med-and-down">
                      <li><a href="../public/m_profile.html">Profile</a></li>
                      <li><a href="../public/mentor.html">Mentor</a></li>
                      <li><a href="../public/mentee.html">Mentee</a></li>
                     <!-- <li><a class="brown-text waves-effect waves-light btn-small">Log in</a></li> -->
                  </ul>
            
                  <ul id="nav-mobile" class="sidenav">
                     <li><a href="../public/m_profile.html">Profile</a></li>
                      <li><a href="../public/mentor.html">Mentor</a></li>
                      <li><a href="../public/mentee.html">Mentee</a></li>
                      <li><a class="brown-text waves-effect waves-light btn-small">Log out</a></li>
                  </ul>
                  <a href="#" data-target="nav-mobile" class="sidenav-trigger"><i class="material-icons">menu</i></a>
                </div>
              </nav>
            
              <div id="index-banner" class="parallax-container">
                <div class="section no-pad-bot">
                  <div class="container">
                    <br><br>
                    <h1 class="header center teal-text text-lighten-2">SonRise</h1><br><br>
                    <h2  class="header center teal-text text-lighten-2">Let's video-chat</h2>                             
                  </div>
                </div>
              </div>
    <div class = "container">
    <h3 id="status">Not Connected</h3>
    <div id="login">
        <input id="endpoint" placeholder="Username" type="text" />
        <button id="doLogin">Connect</button>
    </div>
    
    <div>
        <input id="remoteId" placeholder="User to Call" type="text" />
        <button id="doCall">Call</button>
        <button id="doHangUp">Hang Up</button>
    </div>

    <!-- The person you're calling -->
    <div id="remoteVideoSource"></div>

    <!-- You -->
    <div id="localVideoSource"></div>
    <br><br><br>
    </div>

    <script type="text/javascript">
        
        var appid = "b4931d40-ff2b-4c46-8487-bf955a75501d";
        var activeCall;
        // your username
        var endpointId;
        // Create the client object using the AppID 
        var client = respoke.createClient({
            appId: appid,
            developmentMode: true
        });
        // "connect" event fired after successful connection to Respoke
        client.listen('connect', function() {
            $("#status").html("Connected via SonRise as \"" + endpointId + "\"");
            console.log("Client: ", client);
        });
        // Connect to Respoke when the user clicks "connect"
        $("#doLogin").click(function() {
            $("#status").html("Connecting...");
            endpointId = $("#endpoint").val();
            client.connect({
                endpointId: endpointId // username is the endpoint
            });
        });
        // The options for our video call including constraints and callbacks
        var callOptions = {
            constraints: {audio: true, video: true},
            // Your video
            onLocalMedia: function(evt) {
                setVideo('localVideoSource', evt.element)
            },
            // Their video
            onConnect: function(evt) {
                setVideo('remoteVideoSource', evt.element)
            }
        };
        
        // Listen for incoming calls
        client.listen('call', function(evt) {
            activeCall = evt.call;
            // We only want to answer if we didn't initiate the call
            if(activeCall.caller !== true) {
                activeCall.answer(callOptions);
                // The hangup event indicates the call is over
                activeCall.listen('hangup', function () {
                    hangUp();
                });
            }
        });
        // Call the recipient
        $("#doCall").click(function() {
            var recipientId = $("#remoteId").val();
            var recipientEndpoint = client.getEndpoint({ id: recipientId });
            activeCall = recipientEndpoint.startVideoCall(callOptions);
        });
        // Hangup the call
        $("#doHangUp").click(hangUp);
        // Adds the supplied video element as a child of the supplied element
        function setVideo(elementId, videoElement) {
            var videoParent = document.getElementById(elementId);
            videoParent.innerHTML = "";
            videoParent.appendChild(videoElement);
        }
        // End the current call and clean up the DOM
        function hangUp() {
            activeCall.hangup();
            activeCall = null;
            // Remove the video elements
            $("#localVideoSource").html("");
            $("#remoteVideoSource").html("");
        }
    </script>
</body>

</html>